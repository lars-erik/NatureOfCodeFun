<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <style type="text/css">
        body {
            background: black;
        }

        #canvas {
            position: fixed;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
        }

        #offcvs {
            position: absolute;
            top: 0;
            left: 0;
            width: 10px;
            height: 10px;
            /*position: fixed;
            left: 0;
            top: 0;*/
            border: 1px solid white;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <script src="../Scripts/math.js"></script>
    <script src="perlin.js"></script>

    <script type="text/javascript">
        var size = 6,
            set = new noise.perlin(size, 3),
            cvs = document.getElementById("canvas"),
            offCvs = document.createElement("canvas"),
            ctx = cvs.getContext("2d"),
            offCtx = offCvs.getContext("2d"),
            width = canvas.width = window.innerWidth,
            height = canvas.height = window.innerHeight,
            xsize = offCvs.width = 320,
            ysize = offCvs.height = Math.floor(xsize * (height / width)),
            xscale = size / xsize,
            yscale = size / xsize,
            val,
            col, rgb=[0,0,0],
            x, y,
            imageData,
            idx,
            time = 0,
            timeincr = 0.05,
            colors = [
            [255,51,51],
                [255,56,51],
                [255,61,51],
                [255,65,51],
                [255,70,51],
                [255,75,51],
                [255,80,51],
                [255,84,51],
                [255,89,51],
                [255,94,51],
                [255,99,51],
                [255,104,51],
                [255,108,51],
                [255,113,51],
                [255,118,51],
                [255,123,51],
                [255,128,51],
                [255,132,51],
                [255,137,51],
                [255,142,51],
                [255,147,51],
                [255,151,51],
                [255,156,51],
                [255,161,51],
                [255,166,51],
                [255,171,51],
                [255,175,51],
                [255,180,51],
                [255,185,51],
                [255,190,51],
                [255,194,51],
                [255,199,51],
                [255,204,51],
                [255,209,51],
                [255,214,51],
                [255,218,51],
                [255,223,51],
                [255,228,51],
                [255,233,51],
                [255,237,51],
                [255,242,51],
                [255,247,51],
                [255,252,51],
                [253,255,51],
                [249,255,51],
                [244,255,51],
                [239,255,51],
                [234,255,51],
                [230,255,51],
                [225,255,51],
                [220,255,51],
                [215,255,51],
                [210,255,51],
                [206,255,51],
                [201,255,51],
                [196,255,51],
                [191,255,51],
                [186,255,51],
                [182,255,51],
                [177,255,51],
                [172,255,51],
                [167,255,51],
                [163,255,51],
                [158,255,51],
                [153,255,51],
                [148,255,51],
                [143,255,51],
                [139,255,51],
                [134,255,51],
                [129,255,51],
                [124,255,51],
                [120,255,51],
                [115,255,51],
                [110,255,51],
                [105,255,51],
                [100,255,51],
                [96,255,51],
                [91,255,51],
                [86,255,51],
                [81,255,51],
                [77,255,51],
                [72,255,51],
                [67,255,51],
                [62,255,51],
                [57,255,51],
                [53,255,51],
                [51,255,54],
                [51,255,59],
                [51,255,64],
                [51,255,69],
                [51,255,73],
                [51,255,78],
                [51,255,83],
                [51,255,88],
                [51,255,92],
                [51,255,97],
                [51,255,102],
                [51,255,107],
                [51,255,112],
                [51,255,116],
                [51,255,121],
                [51,255,126],
                [51,255,131],
                [51,255,135],
                [51,255,140],
                [51,255,145],
                [51,255,150],
                [51,255,155],
                [51,255,159],
                [51,255,164],
                [51,255,169],
                [51,255,174],
                [51,255,179],
                [51,255,183],
                [51,255,188],
                [51,255,193],
                [51,255,198],
                [51,255,202],
                [51,255,207],
                [51,255,212],
                [51,255,217],
                [51,255,222],
                [51,255,226],
                [51,255,231],
                [51,255,236],
                [51,255,241],
                [51,255,245],
                [51,255,250],
                [51,255,255],
                [51,250,255],
                [51,245,255],
                [51,241,255],
                [51,236,255],
                [51,231,255],
                [51,226,255],
                [51,222,255],
                [51,217,255],
                [51,212,255],
                [51,207,255],
                [51,202,255],
                [51,198,255],
                [51,193,255],
                [51,188,255],
                [51,183,255],
                [51,179,255],
                [51,174,255],
                [51,169,255],
                [51,164,255],
                [51,159,255],
                [51,155,255],
                [51,150,255],
                [51,145,255],
                [51,140,255],
                [51,135,255],
                [51,131,255],
                [51,126,255],
                [51,121,255],
                [51,116,255],
                [51,112,255],
                [51,107,255],
                [51,102,255],
                [51,97,255],
                [51,92,255],
                [51,88,255],
                [51,83,255],
                [51,78,255],
                [51,73,255],
                [51,69,255],
                [51,64,255],
                [51,59,255],
                [51,54,255],
                [53,51,255],
                [57,51,255],
                [62,51,255],
                [67,51,255],
                [72,51,255],
                [77,51,255],
                [81,51,255],
                [86,51,255],
                [91,51,255],
                [96,51,255],
                [100,51,255],
                [105,51,255],
                [110,51,255],
                [115,51,255],
                [120,51,255],
                [124,51,255],
                [129,51,255],
                [134,51,255],
                [139,51,255],
                [143,51,255],
                [148,51,255],
                [153,51,255],
                [158,51,255],
                [163,51,255],
                [167,51,255],
                [172,51,255],
                [177,51,255],
                [182,51,255],
                [186,51,255],
                [191,51,255],
                [196,51,255],
                [201,51,255],
                [206,51,255],
                [210,51,255],
                [215,51,255],
                [220,51,255],
                [225,51,255],
                [230,51,255],
                [234,51,255],
                [239,51,255],
                [244,51,255],
                [249,51,255],
                [253,51,255],
                [255,51,252],
                [255,51,247],
                [255,51,242],
                [255,51,237],
                [255,51,233],
                [255,51,228],
                [255,51,223],
                [255,51,218],
                [255,51,214],
                [255,51,209],
                [255,51,204],
                [255,51,199],
                [255,51,194],
                [255,51,190],
                [255,51,185],
                [255,51,180],
                [255,51,175],
                [255,51,171],
                [255,51,166],
                [255,51,161],
                [255,51,156],
                [255,51,151],
                [255,51,147],
                [255,51,142],
                [255,51,137],
                [255,51,132],
                [255,51,128],
                [255,51,123],
                [255,51,118],
                [255,51,113],
                [255,51,108],
                [255,51,104],
                [255,51,99],
                [255,51,94],
                [255,51,89],
                [255,51,84],
                [255,51,80],
                [255,51,75],
                [255,51,70],
                [255,51,65],
                [255,51,61],
                [255,51,56],

            ]
            ;

        function draw() {
            imageData = offCtx.createImageData(xsize, ysize);

            if (Math.floor(time * 100, 0) % 2 == 0) {
                var last = colors.pop();
                colors = [last].concat(colors);
            }

            for (y = 0; y < ysize; y++) {
                for (x = 0; x < xsize; x++) {
                    idx = (y * xsize + x) * 4;
                    val = set.noise([x * xscale, y * yscale, time]);

                    var intensity = Math.pow(Math.abs(val), 1.2);
                    col = Math.floor(intensity * 255);
                    rgb = colors[col];
                    imageData.data[idx] = rgb[0] * intensity;
                    imageData.data[idx+1] = rgb[1] * intensity;// * .3;
                    imageData.data[idx+2] = rgb[2] * intensity;// * .2;
                    imageData.data[idx + 3] = 255;
                }
            }

            offCtx.putImageData(imageData, 0, 0);
            ctx.drawImage(offCvs, 0, 0, width, height);

            time += timeincr;

            requestAnimationFrame(draw);
        }

        function newFrame() {
            set = new noise.perlin(size, 3);
        }

        draw();

        document.body.onclick = newFrame;

    </script>
</body>
</html>
